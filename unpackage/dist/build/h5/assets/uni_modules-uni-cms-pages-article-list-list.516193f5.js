import{_ as e,E as t,al as a,n as i,K as l,o as n,c as s,w as r,i as o,a as c,d,e as u,r as h,F as f,J as _,H as g,f as p,g as m,t as b,b as y,h as C,j as x,G as k,k as v,l as w}from"./index.1c5e976d.js";import{_ as D}from"./download-excel.469590f6.js";import{_ as $}from"./uni-dateformat.9c185026.js";import{_ as S}from"./uni-pagination.4b6fd0ad.js";import{_ as z}from"./unicloud-db.11caf7ca.js";import{e as T,f as I}from"./uni-cms-articles.881ab579.js";const E=t.database(),F=[],j={ascending:"asc",descending:"desc"};const V=e({data:()=>({collectionList:[E.collection("uni-cms-articles").field("user_id,category_id,content,title,excerpt,article_status,view_count,like_count,is_sticky,is_essence,comment_status,comment_count,last_comment_user_id,thumbnail,publish_date,publish_ip,last_modify_date,last_modify_ip").getTemp(),E.collection("uni-cms-categories").field("name as text, _id").getTemp(),E.collection("uni-id-users").field("nickname, _id").getTemp()],query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{article_status_localdata:[{value:0,text:"草稿箱"},{value:1,text:"已发布"}],comment_status_localdata:[{value:0,text:"关闭"},{value:1,text:"开放"}]},...T},imageStyles:{width:64,height:64},exportExcel:{filename:"uni-cms-articles.xls",type:"xls",fields:{"用户ID":"user_id","分类":"category_id","标题":"title","文章内容":"content","文章摘录":"excerpt","文章状态":"article_status","阅读数量":"view_count","点赞数":"like_count","是否置顶":"is_sticky","阅读加精":"is_essence","开放评论":"comment_status","评论数":"comment_count","最后评论的用户ID":"last_comment_user_id","封面大图":"thumbnail","发表时间":"publish_date","发布文章时IP地址":"publish_ip","最后修改时间":"last_modify_date","最后修改人IP":"last_modify_ip"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},methods:{previewCover(e){a({current:e,urls:[e]})},onqueryload(e){this.exportExcelData=e},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return F.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){i({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+j[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=I(this._filter,E.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))},takeOffArticle(e){l({title:"下架文章",content:"文章下架后将不会在前台展示，确定下架吗？",success:t=>{t.confirm&&this.$refs.udb.update(e,{article_status:0},{success:e=>{this.$refs.table.clearSelection(),this.$refs.udb.loadData()}})}})}}},[["render",function(e,t,a,i,l,T){const I=o,E=_,F=g,j=p(m("download-excel"),D),V=p(m("uni-th"),C),q=p(m("uni-tr"),x),L=k,P=p(m("uni-td"),v),O=p(m("uni-dateformat"),$),U=p(m("uni-table"),w),A=p(m("uni-pagination"),S),B=p(m("unicloud-db"),z);return n(),s(I,null,{default:r((()=>[c(I,{class:"uni-header"},{default:r((()=>[c(I,{class:"uni-group"},{default:r((()=>[c(I,{class:"uni-title"})])),_:1}),c(I,{class:"uni-group"},{default:r((()=>[c(E,{class:"uni-search",type:"text",modelValue:l.query,"onUpdate:modelValue":t[0]||(t[0]=e=>l.query=e),onConfirm:T.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),c(F,{class:"uni-button",type:"default",size:"mini",onClick:T.search},{default:r((()=>[d("搜索")])),_:1},8,["onClick"]),c(F,{class:"uni-button",type:"default",size:"mini",onClick:t[1]||(t[1]=e=>T.navigateTo("../add/add"))},{default:r((()=>[d("新增")])),_:1}),c(F,{class:"uni-button",type:"default",size:"mini",disabled:!l.selectedIndexs.length,onClick:T.delTable},{default:r((()=>[d(" 批量删除 ")])),_:1},8,["disabled","onClick"]),c(j,{class:"hide-on-phone",fields:l.exportExcel.fields,data:l.exportExcelData,type:l.exportExcel.type,name:l.exportExcel.filename},{default:r((()=>[c(F,{class:"uni-button",type:"primary",size:"mini"},{default:r((()=>[d("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),c(I,{class:"uni-container"},{default:r((()=>[c(B,{ref:"udb",collection:l.collectionList,where:l.where,"page-data":"replace",orderby:l.orderby,getcount:!0,"page-size":l.options.pageSize,"page-current":l.options.pageCurrent,options:l.options,loadtime:"manual",onLoad:T.onqueryload},{default:r((({data:e,pagination:a,loading:i,error:l,options:o})=>[c(U,{ref:"table",loading:i,emptyText:l.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:T.selectionChange},{default:r((()=>[c(q,null,{default:r((()=>[c(V,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>T.filterChange(e,"thumbnail")),sortable:"",onSortChange:t[3]||(t[3]=e=>T.sortChange(e,"thumbnail"))},{default:r((()=>[d("封面大图 ")])),_:1}),c(V,{align:"center","filter-type":"search",onFilterChange:t[4]||(t[4]=e=>T.filterChange(e,"title")),sortable:"",onSortChange:t[5]||(t[5]=e=>T.sortChange(e,"title"))},{default:r((()=>[d("标题 ")])),_:1}),c(V,{align:"center","filter-type":"search",onFilterChange:t[6]||(t[6]=e=>T.filterChange(e,"excerpt")),sortable:"",onSortChange:t[7]||(t[7]=e=>T.sortChange(e,"excerpt"))},{default:r((()=>[d("摘要 ")])),_:1}),c(V,{align:"center",sortable:"",onSortChange:t[8]||(t[8]=e=>T.sortChange(e,"user_id"))},{default:r((()=>[d("作者")])),_:1}),c(V,{align:"center"},{default:r((()=>[d("分类")])),_:1}),c(V,{align:"center","filter-type":"select","filter-data":o.filterData.article_status_localdata,onFilterChange:t[9]||(t[9]=e=>T.filterChange(e,"article_status"))},{default:r((()=>[d("文章状态 ")])),_:2},1032,["filter-data"]),c(V,{align:"center","filter-type":"range",onFilterChange:t[10]||(t[10]=e=>T.filterChange(e,"view_count")),sortable:"",onSortChange:t[11]||(t[11]=e=>T.sortChange(e,"view_count"))},{default:r((()=>[d("阅读数量 ")])),_:1}),c(V,{align:"center","filter-type":"timestamp",onFilterChange:t[12]||(t[12]=e=>T.filterChange(e,"publish_date")),sortable:"",onSortChange:t[13]||(t[13]=e=>T.sortChange(e,"publish_date"))},{default:r((()=>[d("发布时间 ")])),_:1}),c(V,{align:"center"},{default:r((()=>[d("操作")])),_:1})])),_:2},1024),(n(!0),u(f,null,h(e,((e,t)=>(n(),s(q,{key:t},{default:r((()=>[e.thumbnail?(n(),s(P,{key:0,align:"center"},{default:r((()=>[c(L,{src:e.thumbnail,mode:"aspectFill",style:{width:"120px",height:"80px",cursor:"pointer"},onClick:t=>T.previewCover(e.thumbnail)},null,8,["src","onClick"])])),_:2},1024)):(n(),s(P,{key:1,align:"center"})),c(P,{align:"center"},{default:r((()=>[d(b(e.title),1)])),_:2},1024),c(P,{align:"center"},{default:r((()=>[d(b(e.excerpt),1)])),_:2},1024),c(P,{align:"center"},{default:r((()=>[d(b(e.user_id&&e.user_id[0]&&e.user_id[0].nickname||"-"),1)])),_:2},1024),c(P,{align:"center"},{default:r((()=>[d(b(e.category_id&&e.category_id[0]&&e.category_id[0].text||"-"),1)])),_:2},1024),c(P,{align:"center"},{default:r((()=>[d(b(o.article_status_valuetotext[e.article_status]),1)])),_:2},1024),c(P,{align:"center"},{default:r((()=>[d(b(e.view_count||0),1)])),_:2},1024),c(P,{align:"center"},{default:r((()=>[c(O,{threshold:[0,0],date:e.publish_date},null,8,["date"])])),_:2},1024),c(P,{align:"center"},{default:r((()=>[c(I,{class:"uni-group"},{default:r((()=>[c(F,{onClick:t=>T.navigateTo("../edit/edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:r((()=>[d("修改 ")])),_:2},1032,["onClick"]),1===e.article_status?(n(),s(F,{key:0,onClick:t=>T.takeOffArticle(e._id),class:"uni-button",size:"mini",type:"default"},{default:r((()=>[d("下架")])),_:2},1032,["onClick"])):y("",!0),c(F,{onClick:t=>T.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:r((()=>[d("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),c(I,{class:"uni-pagination-box"},{default:r((()=>[c(A,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:T.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}],["__scopeId","data-v-77b167bb"]]);export{V as default};
