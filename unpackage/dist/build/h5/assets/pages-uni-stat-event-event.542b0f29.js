import{_ as e,E as a,o as t,c as l,w as n,i,a as o,d as s,q as r,b as u,e as d,r as p,F as c,f as m,g as h,t as f,aC as g,h as _,j as b,k as y,l as C,O as D}from"./index.96d04c0c.js";import{_ as q}from"./uni-stat-breadcrumb.532397ab.js";import{_ as x}from"./uni-link.41ad7512.js";import{_ as V}from"./uni-data-select.77e53882.js";import{_ as v}from"./uni-stat-tabs.66b03f23.js";import{_ as T}from"./uni-pagination.1c4c12cb.js";import{_ as k}from"./uni-popup-dialog.e660f77e.js";import{s as w,d as z,g as j,p as P,m as S}from"./util.9a87b1b0.js";import"./uni-tooltip.2bdb2fa0.js";const U=[{title:"创建时间",field:"create_time",tooltip:"",formatter:""},{title:"事件ID",field:"event_key",stat:-1},{title:"事件参数",field:"param",tooltip:""},{title:"平台",field:"platform",tooltip:""},{title:"设备标识",field:"device_id",tooltip:""}];const I=e({data:()=>({fieldsMap:U,query:{appid:"",platform_id:"",uni_platform:"",channel_id:"",version_id:"",create_time:[]},options:{pageSize:20,pageCurrent:1,total:0},loading:!1,currentDateTab:1,tableData:[],panelData:[],queryId:"",updateValue:"",channelData:[]}),computed:{channelQuery(){const e=this.query.platform_id;return w({platform_id:e})},versionQuery(){const{appid:e,uni_platform:a}=this.query;return w({appid:e,uni_platform:a})}},created(){this.debounceGet=z((()=>this.getAllData())),this.getChannelData()},watch:{query:{deep:!0,handler(e){this.options.pageCurrent=1,this.debounceGet()}}},methods:{useDatetimePicker(){this.currentDateTab=-1},changeAppid(e){this.getChannelData(e,!1)},changePlatform(e,a,t,l){this.getChannelData(null,e),this.query.version_id=0,this.query.uni_platform=l.code},changeTimeRange(e,a){this.currentDateTab=a;const t=j(e),l=j(0)-1;this.query.create_time=[t,l]},changePageCurrent(e){this.options.pageCurrent=e.current,this.getTableData()},changePageSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.getTableData()},getAllData(e){this.getTableData(e)},getTableData(e=w(this.query,null,["uni_platform"])){const{pageCurrent:t}=this.options;this.loading=!0;a.database().collection("uni-stat-event-logs","uni-stat-app-platforms").where(e).orderBy("create_time","desc").skip((t-1)*this.options.pageSize).limit(this.options.pageSize).get({getCount:!0}).then((e=>{const{count:a,data:t}=e.result;this.tableData=[],this.options.total=a;for(const l of t)l.create_time=P(l.create_time,"dateTime"),l.platform=l.platform&&l.platform[0].name,S(U,l,l),this.tableData.push(l)})).catch((e=>{console.error(e)})).finally((()=>{this.loading=!1}))},getChannelData(e,t){this.query.channel_id="";const l=a.database(),n={};(e=e||this.query.appid)&&(n.appid=e),(t=t||this.query.platform_id)&&(n.platform_id=t);let i=l.collection("uni-stat-app-platforms").field("_id, name").getTemp(),o=l.collection("uni-stat-app-channels").where(n).field("_id, channel_name, create_time, platform_id").getTemp();l.collection(o,i).orderBy("platform_id","asc").get().then((e=>{let a=e.result.data,t=[];if(a.length>0){let e;for(let l in a)e=a[l].channel_name?a[l].channel_name:"默认",a[l].platform_id.length>0&&(e=a[l].platform_id[0].name+"-"+e),t.push({value:a[l]._id,text:e})}this.channelData=t})).catch((e=>{console.error(e)})).finally((()=>{}))}}},[["render",function(e,a,w,z,j,P){const S=m(h("uni-stat-breadcrumb"),q),U=m(h("uni-link"),x),I=i,Q=m(h("uni-data-select"),V),A=m(h("uni-stat-tabs"),v),M=m(h("uni-datetime-picker"),g),B=m(h("uni-th"),_),G=m(h("uni-tr"),b),O=m(h("uni-td"),y),R=m(h("uni-table"),C),E=m(h("uni-pagination"),T),F=m(h("uni-popup-dialog"),k),L=m(h("uni-popup"),D);return t(),l(I,{class:"fix-top-window"},{default:n((()=>[o(I,{class:"uni-header"},{default:n((()=>[o(S,{class:"uni-stat-breadcrumb-on-phone"}),o(I,{class:"uni-group"},{default:n((()=>[o(I,{class:"uni-sub-title hide-on-phone"},{default:n((()=>[s("分析用户自定义事件 "),o(U,{href:"https://ask.dcloud.net.cn/article/36304",text:"自定义事件说明>>"})])),_:1})])),_:1})])),_:1}),o(I,{class:"uni-container"},{default:n((()=>[o(I,{class:"uni-stat--x flex p-1015"},{default:n((()=>[o(Q,{collection:"opendb-app-list",field:"appid as value, name as text",orderby:"text asc",defItem:1,label:"应用选择",modelValue:j.query.appid,"onUpdate:modelValue":a[0]||(a[0]=e=>j.query.appid=e),clear:!1},null,8,["modelValue"]),o(Q,{collection:"opendb-app-versions",where:P.versionQuery,class:"ml-m",field:"_id as value, version as text, uni_platform as label, create_date as date",format:"{label} - {text}",orderby:"date desc",label:"版本选择",modelValue:j.query.version_id,"onUpdate:modelValue":a[1]||(a[1]=e=>j.query.version_id=e)},null,8,["where","modelValue"])])),_:1}),o(I,{class:"uni-stat--x flex"},{default:n((()=>[o(A,{label:"日期选择",current:j.currentDateTab,mode:"date",onChange:P.changeTimeRange},null,8,["current","onChange"]),o(M,{type:"daterange",end:(new Date).getTime(),modelValue:j.query.create_time,"onUpdate:modelValue":a[2]||(a[2]=e=>j.query.create_time=e),returnType:"timestamp",clearIcon:!1,class:r(["uni-stat-datetime-picker",{"uni-stat__actived":j.currentDateTab<0&&!!j.query.create_time.length}]),onChange:P.useDatetimePicker},null,8,["end","modelValue","class","onChange"])])),_:1}),o(I,{class:"uni-stat--x"},{default:n((()=>[o(A,{label:"平台选择",type:"boldLine",mode:"platform",modelValue:j.query.platform_id,"onUpdate:modelValue":a[3]||(a[3]=e=>j.query.platform_id=e),onChange:P.changePlatform},null,8,["modelValue","onChange"]),j.query.platform_id&&-1===j.query.platform_id.indexOf("==")?(t(),l(Q,{key:0,ref:"version-select",collection:"uni-stat-app-channels",where:P.channelQuery,class:"p-channel",field:"_id as value, channel_name as text",orderby:"text asc",label:"渠道/场景值选择",modelValue:j.query.channel_id,"onUpdate:modelValue":a[4]||(a[4]=e=>j.query.channel_id=e)},null,8,["where","modelValue"])):u("",!0)])),_:1}),o(I,{class:"uni-stat--x p-m"},{default:n((()=>[o(R,{loading:j.loading,border:"",stripe:"",emptyText:e.$t("common.empty")},{default:n((()=>[o(G,null,{default:n((()=>[(t(!0),d(c,null,p(j.fieldsMap,((e,a)=>(t(),d(c,{key:a},[e.title?(t(),l(B,{key:a,align:"center"},{default:n((()=>[s(f(e.title),1)])),_:2},1024)):u("",!0)],64)))),128))])),_:1}),(t(!0),d(c,null,p(j.tableData,((e,a)=>(t(),l(G,{key:a},{default:n((()=>[(t(!0),d(c,null,p(j.fieldsMap,((a,i)=>(t(),l(O,{align:"center",key:i},{default:n((()=>[s(f(void 0!==e[a.field]?e[a.field]:"-"),1)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1},8,["loading","emptyText"]),o(I,{class:"uni-pagination-box"},{default:n((()=>[o(E,{"show-icon":"","show-page-size":"","page-size":j.options.pageSize,current:j.options.pageCurrent,total:j.options.total,onChange:P.changePageCurrent,onPageSizeChange:P.changePageSize},null,8,["page-size","current","total","onChange","onPageSizeChange"])])),_:1})])),_:1})])),_:1}),o(L,{ref:"inputDialog",type:"dialog",maskClick:!0},{default:n((()=>[o(F,{ref:"inputClose",mode:"input",title:"请编辑名称",modelValue:j.updateValue,"onUpdate:modelValue":a[5]||(a[5]=e=>j.updateValue=e),placeholder:"请输入内容",onConfirm:e.editName},null,8,["modelValue","onConfirm"])])),_:1},512)])),_:1})}],["__scopeId","data-v-c61d4bff"]]);export{I as default};
