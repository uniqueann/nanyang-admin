import{_ as e,D as t,o as i,c as s,w as o,C as a,b as l,m as n,i as d,T as c,U as r,V as u,n as h,W as p,J as g,K as f,f as m,g as y,H as b,X as w,Y as k,Z as _,x as S,$ as x,a as C,a0 as v,d as I,t as B,p as T,N as M,a1 as P,a2 as L,q as $,s as F,e as A,F as U}from"./index-52dd6894.js";import{_ as j}from"./uni-popup-dialog.01792593.js";const z=e({name:"cloud-image",emits:["click"],props:{mode:{type:String,default:()=>"widthFix"},src:{default:()=>""},width:{type:String,default:()=>"100rpx"},height:{type:String,default:()=>"100rpx"}},watch:{src:{handler(e){e&&"cloud://"==e.substring(0,8)?t.getTempFileURL({fileList:[e]}).then((e=>{this.cSrc=e.fileList[0].tempFileURL})):this.cSrc=e},immediate:!0}},methods:{onClick(){this.$emit("click")}},data:()=>({cSrc:!1})},[["render",function(e,t,c,r,u,h){const p=n,g=d;return i(),s(g,{onClick:h.onClick,style:a([{width:c.width,height:c.height},{"justify-content":"center"}])},{default:o((()=>[u.cSrc?(i(),s(p,{key:0,style:a({width:c.width,height:c.height}),src:u.cSrc,mode:c.mode},null,8,["style","src","mode"])):l("",!0)])),_:1},8,["onClick","style"])}]]);const O=e({data:()=>({isPC:!1}),props:{width:{type:String,default:()=>"50px"},height:{type:String,default:()=>"50px"},border:{type:Boolean,default:()=>!1}},async mounted(){this.isPC=!["ios","android"].includes(c().platform)},computed:{hasLogin:()=>r.hasLogin,userInfo:()=>r.userInfo,avatar_file:()=>r.userInfo.avatar_file},methods:{setAvatarFile(e){u.updateUserInfo({avatar_file:e})},uploadAvatarImg(e){if(!this.hasLogin)return h({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"});const i={quality:100,width:600,height:600,resize:!0};p({count:1,crop:i,success:async e=>{let s=e.tempFiles[0],o={extname:s.name.split(".")[s.name.split(".").length-1]},a=e.tempFilePaths[0];a=await new Promise((e=>{this.isPC||h({url:"/uni_modules/uni-id-pages/pages/userinfo/cropImage/cropImage?path="+a+`&options=${JSON.stringify(i)}`,animationType:"fade-in",events:{success:t=>{e(t)}},complete(e){}})}));let l=this.userInfo._id+""+Date.now();o.name=l,g({title:"更新中",mask:!0});let{fileID:n}=await t.uploadFile({filePath:a,cloudPath:l,fileType:"image"});o.url=n,f(),this.setAvatarFile(o)}})}}},[["render",function(e,t,l,n,c,r){const u=m(y("cloud-image"),z),h=m(y("uni-icons"),b),p=d;return i(),s(p,{onClick:r.uploadAvatarImg,class:w(["box",{showBorder:l.border}]),style:a({width:l.width,height:l.height,lineHeight:l.height})},{default:o((()=>[r.avatar_file?(i(),s(u,{key:0,src:r.avatar_file.url,width:l.width,height:l.height},null,8,["src","width","height"])):(i(),s(h,{key:1,style:a({width:l.width,height:l.height,lineHeight:l.height}),class:"chooseAvatar",type:"plusempty",size:"30",color:"#dddddd"},null,8,["style"]))])),_:1},8,["onClick","class","style"])}],["__scopeId","data-v-fb74d26b"]]);const N=e({name:"UniListItem",emits:["click","switchChange"],props:{direction:{type:String,default:"row"},title:{type:String,default:""},note:{type:String,default:""},ellipsis:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},clickable:{type:Boolean,default:!1},showArrow:{type:[Boolean,String],default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},showBadge:{type:[Boolean,String],default:!1},showSwitch:{type:[Boolean,String],default:!1},switchChecked:{type:[Boolean,String],default:!1},badgeText:{type:String,default:""},badgeType:{type:String,default:"success"},badgeStyle:{type:Object,default:()=>({})},rightText:{type:String,default:""},thumb:{type:String,default:""},thumbSize:{type:String,default:"base"},showExtraIcon:{type:[Boolean,String],default:!1},extraIcon:{type:Object,default:()=>({type:"",color:"#000000",size:20,customPrefix:""})},border:{type:Boolean,default:!0},customStyle:{type:Object,default:()=>({padding:"",backgroundColor:"#FFFFFF"})},keepScrollPosition:{type:Boolean,default:!1}},watch:{"customStyle.padding":{handler(e){"number"==typeof e&&(e+="");let t=e.split(" ");1===t.length?this.padding={top:e,right:e,bottom:e,left:e}:2===t.length?this.padding={top:e[0],right:e[1],bottom:e[0],left:e[1]}:4===t.length&&(this.padding={top:e[0],right:e[1],bottom:e[2],left:e[3]})},immediate:!0}},data:()=>({isFirstChild:!1,padding:{top:"",right:"",bottom:"",left:""}}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0))},methods:{getForm(e="uniList"){let t=this.$parent,i=t.$options.name;for(;i!==e;){if(t=t.$parent,!t)return!1;i=t.$options.name}return t},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},onSwitchChange(e){this.$emit("switchChange",e.detail)},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(e){let t={url:this.to,success:e=>{this.$emit("click",{data:e})},fail:e=>{this.$emit("click",{data:e})}};switch(e){case"navigateTo":default:h(t);break;case"redirectTo":S(t);break;case"reLaunch":_(t);break;case"switchTab":k(t)}}}},[["render",function(e,t,c,r,u,h){const p=d,g=n,f=m(y("uni-icons"),b),k=T,_=m(y("uni-badge"),x),S=M;return i(),s(p,{class:w([{"uni-list-item--disabled":c.disabled},"uni-list-item"]),style:a({"background-color":c.customStyle.backgroundColor}),"hover-class":!c.clickable&&!c.link||c.disabled||c.showSwitch?"":"uni-list-item--hover",onClick:h.onClick},{default:o((()=>[u.isFirstChild?l("",!0):(i(),s(p,{key:0,class:w(["border--left",{"uni-list--border":c.border}])},null,8,["class"])),C(p,{class:w(["uni-list-item__container",{"container--right":c.showArrow||c.link,"flex--direction":"column"===c.direction}]),style:a({paddingTop:u.padding.top,paddingLeft:u.padding.left,paddingRight:u.padding.right,paddingBottom:u.padding.bottom})},{default:o((()=>[v(e.$slots,"header",{},(()=>[C(p,{class:"uni-list-item__header"},{default:o((()=>[c.thumb?(i(),s(p,{key:0,class:"uni-list-item__icon"},{default:o((()=>[C(g,{src:c.thumb,class:w(["uni-list-item__icon-img",["uni-list--"+c.thumbSize]])},null,8,["src","class"])])),_:1})):c.showExtraIcon?(i(),s(p,{key:1,class:"uni-list-item__icon"},{default:o((()=>[C(f,{customPrefix:c.extraIcon.customPrefix,color:c.extraIcon.color,size:c.extraIcon.size,type:c.extraIcon.type},null,8,["customPrefix","color","size","type"])])),_:1})):l("",!0)])),_:1})]),!0),v(e.$slots,"body",{},(()=>[C(p,{class:w(["uni-list-item__content",{"uni-list-item__content--center":c.thumb||c.showExtraIcon||c.showBadge||c.showSwitch}])},{default:o((()=>[c.title?(i(),s(k,{key:0,class:w(["uni-list-item__content-title",[0!==c.ellipsis&&c.ellipsis<=2?"uni-ellipsis-"+c.ellipsis:""]])},{default:o((()=>[I(B(c.title),1)])),_:1},8,["class"])):l("",!0),c.note?(i(),s(k,{key:1,class:"uni-list-item__content-note"},{default:o((()=>[I(B(c.note),1)])),_:1})):l("",!0)])),_:1},8,["class"])]),!0),v(e.$slots,"footer",{},(()=>[c.rightText||c.showBadge||c.showSwitch?(i(),s(p,{key:0,class:w(["uni-list-item__extra",{"flex--justify":"column"===c.direction}])},{default:o((()=>[c.rightText?(i(),s(k,{key:0,class:"uni-list-item__extra-text"},{default:o((()=>[I(B(c.rightText),1)])),_:1})):l("",!0),c.showBadge?(i(),s(_,{key:1,type:c.badgeType,text:c.badgeText,"custom-style":c.badgeStyle},null,8,["type","text","custom-style"])):l("",!0),c.showSwitch?(i(),s(S,{key:2,disabled:c.disabled,checked:c.switchChecked,onChange:h.onSwitchChange},null,8,["disabled","checked","onChange"])):l("",!0)])),_:1},8,["class"])):l("",!0)]),!0)])),_:3},8,["class","style"]),c.showArrow||c.link?(i(),s(f,{key:1,size:16,class:"uni-icon-wrapper",color:"#bbb",type:"arrowright"})):l("",!0)])),_:3},8,["class","style","hover-class","onClick"])}],["__scopeId","data-v-884788c9"]]);const q=e({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{stackFromEnd:{type:Boolean,default:!1},enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0},renderReverse:{type:Boolean,default:!1}},created(){this.firstChildAppend=!1},methods:{loadMore(e){this.$emit("scrolltolower")},scroll(e){this.$emit("scroll",e)}}},[["render",function(e,t,a,n,c,r){const u=d;return i(),s(u,{class:"uni-list uni-border-top-bottom"},{default:o((()=>[a.border?(i(),s(u,{key:0,class:"uni-list--border-top"})):l("",!0),v(e.$slots,"default",{},void 0,!0),a.border?(i(),s(u,{key:1,class:"uni-list--border-bottom"})):l("",!0)])),_:3})}],["__scopeId","data-v-1f7cd97b"]]);t.database().collection("uni-id-users");const R=t.importObject("uni-id-co");const W=e({emits:["success"],computed:{},data:()=>({}),methods:{beforeGetphonenumber:async()=>await new Promise(((e,i)=>{g({mask:!0}),wx.checkSession({success(){e(),f()},fail(){P({success({code:s}){t.importObject("uni-id-co",{customUI:!0}).loginByWeixin({code:s}).then((t=>{e()})).catch((e=>{console.log(e),i()})).finally((e=>{f()}))},fail:e=>{console.error(e),i()}})}})})),async bindMobileByMpWeixin(e){"getPhoneNumber:ok"==e.detail.errMsg?(await this.beforeGetphonenumber(),R.bindMobileByMpWeixin(e.detail).then((e=>{this.$emit("success")})).finally((e=>{this.closeMe()}))):this.closeMe()},async open(){this.$refs.popup.open()},closeMe(e){this.$refs.popup.close()}}},[["render",function(e,t,a,l,n,c){const r=T,u=$,h=d,p=m(y("uni-popup"),L);return i(),s(p,{ref:"popup",type:"bottom"},{default:o((()=>[C(h,{class:"box"},{default:o((()=>[C(r,{class:"headBox"},{default:o((()=>[I("绑定资料")])),_:1}),C(r,{class:"tip"},{default:o((()=>[I("将一键获取你的手机号码绑定你的个人资料")])),_:1}),C(h,{class:"btnBox"},{default:o((()=>[C(r,{onClick:c.closeMe,class:"close"},{default:o((()=>[I("关闭")])),_:1},8,["onClick"]),C(u,{class:"agree uni-btn",type:"primary","open-type":"getPhoneNumber",onGetphonenumber:c.bindMobileByMpWeixin},{default:o((()=>[I("获取")])),_:1},8,["onGetphonenumber"])])),_:1})])),_:1})])),_:1},512)}],["__scopeId","data-v-0296d063"]]),E=t.importObject("uni-id-co");const G=e({computed:{userInfo:()=>r.userInfo},data:()=>({univerifyStyle:{authButton:{title:"本机号码一键绑定"},otherLoginButton:{title:"其他号码绑定"}},hasPwd:!1,showLoginManage:!1}),async onShow(){this.univerifyStyle.authButton.title="本机号码一键绑定",this.univerifyStyle.otherLoginButton.title="其他号码绑定"},async onLoad(e){e.showLoginManage&&(this.showLoginManage=!0);let t=await E.getAccountInfo();this.hasPwd=t.isPasswordSet},methods:{login(){h({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd",complete:e=>{}})},logout(){u.logout()},bindMobileSuccess(){u.updateUserInfo()},changePassword(){h({url:"/uni_modules/uni-id-pages/pages/userinfo/change_pwd/change_pwd",complete:e=>{}})},bindMobile(){this.bindMobileBySmsCode()},univerify(){P({provider:"univerify",univerifyStyle:this.univerifyStyle,success:async e=>{E.bindMobileByUniverify(e.authResult).then((e=>{u.updateUserInfo()})).catch((e=>{console.log(e)})).finally((e=>{uni.closeAuthView()}))},fail:e=>{console.log(e),"30002"!=e.code&&"30001"!=e.code||this.bindMobileBySmsCode()}})},bindMobileBySmsCode(){h({url:"./bind-mobile/bind-mobile"})},setNickname(e){e?(u.updateUserInfo({nickname:e}),this.$refs.dialog.close()):this.$refs.dialog.open()},deactivate(){h({url:"/uni_modules/uni-id-pages/pages/userinfo/deactivate/deactivate"})},async bindThirdAccount(e){const i=t.importObject("uni-id-co"),s={weixin:"wx_openid",alipay:"ali_openid",apple:"apple_openid",qq:"qq_openid"}[e.toLowerCase()];this.userInfo[s]?(await i["unbind"+e](),await u.updateUserInfo()):P({provider:e.toLowerCase(),onlyAuthorize:!0,success:async t=>{const s=await i["bind"+e]({code:t.code});s.errCode&&F({title:s.errMsg||"绑定失败",duration:3e3}),await u.updateUserInfo()},fail:async e=>{console.log(e),f()}})}}},[["render",function(e,t,a,n,c,r){const u=m(y("uni-id-pages-avatar"),O),h=d,p=m(y("uni-list-item"),N),g=m(y("uni-list"),q),f=m(y("uni-popup-dialog"),j),b=m(y("uni-popup"),L),w=m(y("uni-id-pages-bind-mobile"),W),k=$;return i(),s(h,{class:"uni-content"},{default:o((()=>[C(h,{class:"avatar"},{default:o((()=>[C(u,{width:"260rpx",height:"260rpx"})])),_:1}),C(g,null,{default:o((()=>[C(p,{class:"item",onClick:t[0]||(t[0]=e=>r.setNickname("")),title:"昵称",rightText:r.userInfo.nickname||"未设置",link:""},null,8,["rightText"]),C(p,{class:"item",onClick:r.bindMobile,title:"手机号",rightText:r.userInfo.mobile||"未绑定",link:""},null,8,["onClick","rightText"]),r.userInfo.email?(i(),s(p,{key:0,class:"item",title:"电子邮箱",rightText:r.userInfo.email},null,8,["rightText"])):l("",!0),c.hasPwd?(i(),s(p,{key:1,class:"item",onClick:r.changePassword,title:"修改密码",link:""},null,8,["onClick"])):l("",!0)])),_:1}),C(g,{class:"mt10"},{default:o((()=>[C(p,{onClick:r.deactivate,title:"注销账号",link:"navigateTo"},null,8,["onClick"])])),_:1}),C(b,{ref:"dialog",type:"dialog"},{default:o((()=>[C(f,{mode:"input",value:r.userInfo.nickname,onConfirm:r.setNickname,title:"设置昵称",placeholder:"请输入要设置的昵称"},null,8,["value","onConfirm"])])),_:1},512),C(w,{ref:"bind-mobile-by-sms",onSuccess:r.bindMobileSuccess},null,8,["onSuccess"]),c.showLoginManage?(i(),A(U,{key:0},[r.userInfo._id?(i(),s(k,{key:0,onClick:r.logout},{default:o((()=>[I("退出登录")])),_:1},8,["onClick"])):(i(),s(k,{key:1,onClick:r.login},{default:o((()=>[I("去登录")])),_:1},8,["onClick"]))],64)):l("",!0)])),_:1})}],["__scopeId","data-v-ec0ba104"]]);export{G as default};
