import{_ as e,D as t,K as a,s as l,J as s,x as i,A as o,y as n,ac as u,o as r,c as d,w as m,i as c,a as f,d as p,t as h,b as _,f as g,g as x,p as b,M as y,a8 as w,q as k,H as C}from"./index-52dd6894.js";import{_ as j}from"./uni-forms-item.4e6b57d7.js";import{_ as D}from"./uni-file-picker.3f0146be.js";import{_ as v}from"./uni-data-picker.37409a89.js";import{_ as V}from"./uni-forms.9d63b157.js";import{E as P}from"./editor.3db7de24.js";import{v as R}from"./uni-cms-articles.a079bc39.js";import"./uni-load-more.5c08c1b9.js";import"./uni-easyinput.cff98e18.js";import"./uni-tooltip.36348de7.js";import"./uni-dateformat.611f3c3a.js";import"./uni-link.7568b248.js";const T=t.database();T.command;function E(e){let t={};for(let a in R)e.includes(a)&&(t[a]=R[a]);return t}const S=e({components:{EditorComponent:P},data(){let e={user_id:"",category_id:"",title:"",content:{},excerpt:"",article_status:0,is_sticky:null,is_essence:null,comment_status:null,thumbnail:""};return{formData:e,formOptions:{comment_status_localdata:[{value:0,text:"关闭"},{value:1,text:"开放"}]},rules:{...E(Object.keys(e))},formats:{},wordCount:null,thumbnailPreview:{}}},onReady(){this.$refs.form.setRules(this.rules)},methods:{uploadSuccess(e){this.formData.thumbnail=e.tempFilePaths[0],this.thumbnailPreview={extname:"jpg",url:e.tempFilePaths[0]}},onTextChange(e){this.wordCount=e.detail},onEditorReady(e){e&&(this.editorCtx=e)},submit(e){if(!this.formData.title)return a(),l({icon:"none",title:"文章标题必填"});this.$refs.form.validate().then((t=>{this.editorCtx.getContents({success:a=>{this.submitForm({...t,article_status:e,title:this.formData.title.trim(),content:a.delta,publish_date:Date.now()})}})})).catch((e=>{console.error(e)}))},submitForm(e){return s({mask:!0}),T.collection("uni-cms-articles").add(e).then((t=>{l({icon:"none",title:0===e.article_status?"保存成功":"发布成功"});try{this.getOpenerEventChannel().emit("refreshData")}catch(a){}setTimeout((()=>{0===e.article_status?i({url:"/uni_modules/uni-cms/pages/article/edit/edit?id="+t.result.id}):o()}),500)})).catch((e=>{n({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{a()}))},navigateBack(){u().length>1?o(-1):i({url:"/uni_modules/uni-cms/pages/article/list/list"})}}},[["render",function(e,t,a,l,s,i){const o=g(x("uni-icons"),C),n=b,u=c,P=y,R=w("editor-component"),T=g(x("uni-forms-item"),j),E=g(x("uni-file-picker"),D),S=g(x("uni-data-picker"),v),U=k,F=g(x("uni-forms"),V);return r(),d(u,{class:"uni-container"},{default:m((()=>[f(u,{class:"header"},{default:m((()=>[f(u,{class:"back"},{default:m((()=>[f(u,{onClick:i.navigateBack,style:{"margin-left":"15px",display:"flex","align-items":"center"}},{default:m((()=>[f(o,{type:"back",size:"24"}),f(n,null,{default:m((()=>[p("返回")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),f(F,{ref:"form","label-width":90,model:s.formData,validateTrigger:"bind","err-show-type":"toast"},{default:m((()=>[f(u,{class:"edit-box"},{default:m((()=>[f(u,{class:"title"},{default:m((()=>[f(P,{class:"uni-input",modelValue:s.formData.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.formData.title=e),"auto-height":"",placeholder:"文章标题"},null,8,["modelValue"])])),_:1}),f(R,{onTextchange:i.onTextChange,onReady:i.onEditorReady,imageSecCheck:!0},null,8,["onTextchange","onReady"]),f(u,{class:"settings"},{default:m((()=>[f(T,{name:"excerpt",label:"文章摘要"},{default:m((()=>[f(P,{class:"excerpt",placeholder:"文章摘要","auto-height":"",modelValue:s.formData.excerpt,"onUpdate:modelValue":t[1]||(t[1]=e=>s.formData.excerpt=e)},null,8,["modelValue"])])),_:1}),f(T,{name:"thumbnail",label:"封面",required:""},{default:m((()=>[f(E,{modelValue:s.thumbnailPreview,"onUpdate:modelValue":t[2]||(t[2]=e=>s.thumbnailPreview=e),"file-mediatype":"image",mode:"grid","file-extname":"png,jpg",limit:1,"return-type":"object","image-styles":{width:"150px",height:"150px"},onSuccess:i.uploadSuccess},null,8,["modelValue","onSuccess"]),f(u,{style:{color:"#999","font-size":"13px","margin-top":"10px"}},{default:m((()=>[f(n,null,{default:m((()=>[p("为了保证最佳效果展示；请上传16:9的封面图片")])),_:1})])),_:1})])),_:1}),f(T,{name:"user_id",label:"作者",required:""},{default:m((()=>[f(S,{modelValue:s.formData.user_id,"onUpdate:modelValue":t[3]||(t[3]=e=>s.formData.user_id=e),style:{width:"200px"},collection:"uni-id-users",where:"role=='uni-cms-author'",field:"nickname as text, _id as value"},null,8,["modelValue"])])),_:1}),f(T,{name:"category_id",label:"分类"},{default:m((()=>[f(S,{modelValue:s.formData.category_id,"onUpdate:modelValue":t[4]||(t[4]=e=>s.formData.category_id=e),style:{width:"200px"},collection:"uni-cms-categories",field:"name as text, _id as value"},null,8,["modelValue"])])),_:1})])),_:1}),f(u,{class:"uni-button-group m",style:{"padding-bottom":"50px"}},{default:m((()=>[f(U,{class:"uni-button",style:{width:"100px","margin-right":"10px"},onClick:t[5]||(t[5]=e=>i.submit(0))},{default:m((()=>[p("存为草稿")])),_:1}),f(U,{type:"primary",class:"uni-button",style:{width:"100px"},onClick:t[6]||(t[6]=e=>i.submit(1))},{default:m((()=>[p("发布")])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),f(u,{class:"footer"},{default:m((()=>[f(u,{class:"wrap"},{default:m((()=>[f(u,{class:"left"},{default:m((()=>[null!==s.wordCount?(r(),d(n,{key:0,class:"word-count"},{default:m((()=>[p("共 "+h(s.wordCount)+" 字",1)])),_:1})):_("",!0)])),_:1}),f(u,{class:"right"},{default:m((()=>[f(u,{class:"uni-button-group"},{default:m((()=>[f(U,{class:"uni-button",style:{width:"100px","margin-right":"10px"},onClick:t[7]||(t[7]=e=>i.submit(0))},{default:m((()=>[p("存为草稿")])),_:1}),f(U,{type:"primary",class:"uni-button",style:{width:"100px"},onClick:t[8]||(t[8]=e=>i.submit(1))},{default:m((()=>[p("发布")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-f6c88fed"]]);export{S as default};
