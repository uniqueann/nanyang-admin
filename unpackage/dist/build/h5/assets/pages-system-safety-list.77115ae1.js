import{_ as e,E as a,D as t,n,o as r,c as i,w as s,i as l,a as o,d,t as u,e as c,r as p,F as m,f,g,J as h,H as _,h as b,j as y,k as C,l as x}from"./index.1c5e976d.js";import{_ as w}from"./uni-stat-breadcrumb.61aab12d.js";import{_ as z}from"./uni-dateformat.9c185026.js";import{_ as D}from"./uni-pagination.4b6fd0ad.js";import{_ as j}from"./unicloud-db.11caf7ca.js";const k=a.database(),V=["user_id.username","user_id.nickname","type","ip"];const $=e({data:()=>({collectionList:[k.collection("uni-id-log").field("type, ip, create_date, user_id").getTemp(),k.collection("uni-id-users").field("_id, username,nickname").getTemp()],query:"",where:"",orderby:"create_date desc",options:{pageSize:20,pageCurrent:1}}),methods:{getWhere(){const e=this.query.trim();if(!e)return"";let a;try{a=new RegExp(e,"i")}catch(n){return void t({title:"请勿输入等不满足正则格式的符号",icon:"none"})}return V.map((e=>a+".test("+e+")")).join(" || ")},search(){const e=this.getWhere(),a=e===this.where;this.where=e,a&&this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.$refs.udb.loadData({current:e.current})},navigateTo(e){n({url:e,events:{refreshData:()=>{this.loadData()}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((a=>e[a]._id))},delTable(){this.$refs.udb.remove(this.selectedItems())},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e)}}},[["render",function(e,a,t,n,k,V){const $=f(g("uni-stat-breadcrumb"),w),v=h,T=_,q=l,I=f(g("uni-th"),b),L=f(g("uni-tr"),y),P=f(g("uni-td"),C),U=f(g("uni-dateformat"),z),E=f(g("uni-table"),x),S=f(g("uni-pagination"),D),W=f(g("unicloud-db"),j);return r(),i(q,null,{default:s((()=>[o(q,{class:"uni-header"},{default:s((()=>[o($,{class:"uni-stat-breadcrumb-on-phone"}),o(q,{class:"uni-group"},{default:s((()=>[o(v,{class:"uni-search",type:"text",modelValue:k.query,"onUpdate:modelValue":a[0]||(a[0]=e=>k.query=e),onConfirm:V.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),o(T,{class:"uni-button hide-on-phone",type:"default",size:"mini",onClick:V.search},{default:s((()=>[d(u(e.$t("common.button.search")),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),o(q,{class:"uni-container"},{default:s((()=>[o(W,{ref:"udb",collection:k.collectionList,options:k.options,where:k.where,"page-data":"replace",orderby:k.orderby,getcount:!0,"page-size":k.options.pageSize,"page-current":k.options.pageCurrent},{default:s((({data:e,pagination:a,loading:t,error:n})=>[o(E,{loading:t,emptyText:n.message||"没有更多数据",border:"",stripe:""},{default:s((()=>[o(L,null,{default:s((()=>[o(I,{align:"center"},{default:s((()=>[d("序号")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("用户名")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("昵称")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("内容")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("IP")])),_:1}),o(I,{align:"center"},{default:s((()=>[d("时间")])),_:1})])),_:1}),(r(!0),c(m,null,p(e,((e,t)=>(r(),i(L,{key:t},{default:s((()=>[o(P,{align:"center"},{default:s((()=>[d(u((a.current-1)*a.size+(t+1)),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.user_id[0]&&e.user_id[0].username||"-"),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.user_id[0]&&e.user_id[0].nickname||"-"),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.type),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[d(u(e.ip),1)])),_:2},1024),o(P,{align:"center"},{default:s((()=>[o(U,{date:e.create_date,threshold:[0,0]},null,8,["date"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"]),o(q,{class:"uni-pagination-box"},{default:s((()=>[o(S,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:V.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","options","where","orderby","page-size","page-current"])])),_:1})])),_:1})}]]);export{$ as default};
