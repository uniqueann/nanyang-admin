import{_ as e,E as t,n as a,o as n,c as i,w as l,i as s,a as o,d as r,e as d,r as c,F as u,J as h,H as f,f as g,g as p,t as m,h as _,j as b,k as y,l as C}from"./index.1c5e976d.js";import{_ as x}from"./download-excel.469590f6.js";import{_ as k}from"./uni-dateformat.9c185026.js";import{_ as D}from"./uni-pagination.4b6fd0ad.js";import{_ as $}from"./unicloud-db.11caf7ca.js";import{e as w,f as z}from"./uni-cms-categories.9d38cea1.js";const S=t.database(),T=[],E={ascending:"asc",descending:"desc"};const j=e({data:()=>({collectionList:"uni-cms-categories",query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...w},imageStyles:{width:64,height:64},exportExcel:{filename:"uni-cms-categories.xls",type:"xls",fields:{"名称":"name","描述":"description","图标地址":"icon","排序":"sort","文章数量":"article_count","创建时间":"create_date"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},methods:{onqueryload(e){this.exportExcelData=e},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return T.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){a({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+E[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=z(this._filter,S.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,w,z,S){const T=s,E=h,j=f,v=g(p("download-excel"),x),F=g(p("uni-th"),_),I=g(p("uni-tr"),b),V=g(p("uni-td"),y),q=g(p("uni-dateformat"),k),L=g(p("uni-table"),C),U=g(p("uni-pagination"),D),B=g(p("unicloud-db"),$);return n(),i(T,null,{default:l((()=>[o(T,{class:"uni-header"},{default:l((()=>[o(T,{class:"uni-group"},{default:l((()=>[o(T,{class:"uni-title"}),o(T,{class:"uni-sub-title"})])),_:1}),o(T,{class:"uni-group"},{default:l((()=>[o(E,{class:"uni-search",type:"text",modelValue:z.query,"onUpdate:modelValue":t[0]||(t[0]=e=>z.query=e),onConfirm:S.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),o(j,{class:"uni-button",type:"default",size:"mini",onClick:S.search},{default:l((()=>[r("搜索")])),_:1},8,["onClick"]),o(j,{class:"uni-button",type:"default",size:"mini",onClick:t[1]||(t[1]=e=>S.navigateTo("../add/add"))},{default:l((()=>[r("新增")])),_:1}),o(j,{class:"uni-button",type:"default",size:"mini",disabled:!z.selectedIndexs.length,onClick:S.delTable},{default:l((()=>[r("批量删除")])),_:1},8,["disabled","onClick"]),o(v,{class:"hide-on-phone",fields:z.exportExcel.fields,data:z.exportExcelData,type:z.exportExcel.type,name:z.exportExcel.filename},{default:l((()=>[o(j,{class:"uni-button",type:"primary",size:"mini"},{default:l((()=>[r("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),o(T,{class:"uni-container"},{default:l((()=>[o(B,{ref:"udb",collection:z.collectionList,field:"name,description,icon,sort,article_count,create_date",where:z.where,"page-data":"replace",orderby:z.orderby,getcount:!0,"page-size":z.options.pageSize,"page-current":z.options.pageCurrent,options:z.options,loadtime:"manual",onLoad:S.onqueryload},{default:l((({data:e,pagination:a,loading:s,error:h,options:f})=>[o(L,{ref:"table",loading:s,emptyText:h.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:S.selectionChange},{default:l((()=>[o(I,null,{default:l((()=>[o(F,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>S.filterChange(e,"name")),sortable:"",onSortChange:t[3]||(t[3]=e=>S.sortChange(e,"name"))},{default:l((()=>[r("名称")])),_:1}),o(F,{align:"center","filter-type":"search",onFilterChange:t[4]||(t[4]=e=>S.filterChange(e,"description")),sortable:"",onSortChange:t[5]||(t[5]=e=>S.sortChange(e,"description"))},{default:l((()=>[r("描述")])),_:1}),o(F,{align:"center","filter-type":"range",onFilterChange:t[6]||(t[6]=e=>S.filterChange(e,"sort")),sortable:"",onSortChange:t[7]||(t[7]=e=>S.sortChange(e,"sort"))},{default:l((()=>[r("排序")])),_:1}),o(F,{align:"center","filter-type":"timestamp",onFilterChange:t[8]||(t[8]=e=>S.filterChange(e,"create_date")),sortable:"",onSortChange:t[9]||(t[9]=e=>S.sortChange(e,"create_date"))},{default:l((()=>[r("创建时间")])),_:1}),o(F,{align:"center"},{default:l((()=>[r("操作")])),_:1})])),_:1}),(n(!0),d(u,null,c(e,((e,t)=>(n(),i(I,{key:t},{default:l((()=>[o(V,{align:"center"},{default:l((()=>[r(m(e.name),1)])),_:2},1024),o(V,{align:"center"},{default:l((()=>[r(m(e.description),1)])),_:2},1024),o(V,{align:"center"},{default:l((()=>[r(m(e.sort),1)])),_:2},1024),o(V,{align:"center"},{default:l((()=>[o(q,{threshold:[0,0],date:e.create_date},null,8,["date"])])),_:2},1024),o(V,{align:"center"},{default:l((()=>[o(T,{class:"uni-group"},{default:l((()=>[o(j,{onClick:t=>S.navigateTo("../edit/edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:l((()=>[r("修改")])),_:2},1032,["onClick"]),o(j,{onClick:t=>S.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:l((()=>[r("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),o(T,{class:"uni-pagination-box"},{default:l((()=>[o(U,{"show-icon":"","page-size":a.size,modelValue:a.current,"onUpdate:modelValue":e=>a.current=e,total:a.count,onChange:S.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["collection","where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{j as default};
